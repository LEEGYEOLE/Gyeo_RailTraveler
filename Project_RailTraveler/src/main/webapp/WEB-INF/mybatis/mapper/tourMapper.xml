<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tour">

	<select id="tourList" parameterType="map" resultType="com.railer.rt.tour.Tour">
		select t.tournum , t.stanum, t.detailcatenum, t.name, t.tel , t.address ,t.content, t.longitude,t.latitude, t.hitcount,tf.imagefilename,tc.catenum
		from tour t join tourfile tf on t.tournum = tf.tournum
		join detailtourcategory dtc on t.detailcatenum = dtc.detailcatenum
		join tourcategory tc on dtc.catenum = tc.catenum 
        join station st on st.stanum = t.stanum
        join location loc on loc.locnum =st.locnum

		<where>
			 loc.locNum = #{locNum}
			<if test="cateNum !=0">
				and tc.catenum = #{cateNum} 
			</if>
		</where>
		and ROWNUM <![CDATA[ < ]]>  1000
		ORDER BY t.tournum DESC
		OFFSET #{offset} ROWS FETCH FIRST #{items} ROWS ONLY
	</select>
	
	<select id="tourCategoryList" resultType="com.railer.rt.tour.Tour">	
	 select cateNum , cateName from tourcategory
	</select>
	
	
	<select id="dataCount" parameterType="map" resultType="Integer">	
	 	select nvl(count(*),0)
		from tour t join tourfile tf on t.tournum = tf.tournum
		join detailtourcategory dtc on t.detailcatenum = dtc.detailcatenum
		join tourcategory tc on dtc.catenum = tc.catenum 
        join station st on st.stanum = t.stanum
        join location loc on loc.locnum =st.locnum

		<where>
			
			<choose>

				<when test = "name == totalData">

					loc.locNum = #{locNum}
					<if test="cateNum !=0">
						and tc.catenum = #{cateNum} 
					</if>

				</when>

				<otherwise>

 				t.stanum =#{staNum} and t.detailcatenum=#{detailcateNum}		

				</otherwise>

			</choose>
		</where>

	</select>
	
	<select id="localStation" parameterType="Integer" resultType="com.railer.rt.tour.Tour">
		select staName, staNum from station where locnum = #{locNum}
	</select>
	
	<select id="detailTourCategory" parameterType="map" resultType="com.railer.rt.tour.Tour">
	 select detailcateNum, detailcateName from detailtourcategory where catenum =#{cateNum}
	</select>
	
	<select id="detailTourList" parameterType ="map" resultType="com.railer.rt.tour.Tour">
	select t.tournum , t.stanum, t.detailcatenum, t.name, t.tel , t.address ,t.content, t.longitude,t.latitude, t.hitcount,tf.imagefilename,tc.catenum 
	from tour t 
	join tourfile tf on tf.tournum =t.tournum
	join station s on t.stanum = s.stanum 
	join detailtourcategory d on t.detailcatenum = d.detailcatenum 
	join tourcategory tc on d.catenum = tc.catenum 
	where t.stanum =#{staNum} and t.detailcatenum=#{detailcateNum}
	ORDER BY t.tournum DESC
	OFFSET #{offset} ROWS FETCH FIRST #{items} ROWS ONLY
	</select>
	
	




	
</mapper>